{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container">
  <h1 class="archives-title">ğŸ“š Tournois {{ type }} - Archives</h1>

  {% if tournois %}
    {% for tournoi in tournois %}
      <div class="tournoi-block">
        <h2 class="tournoi-date archives">
          ğŸ Tournoi du {{ tournoi.date|date:"l d F Y" }} <span class="badge-archive">TerminÃ©</span>
        </h2>

        <!-- ğŸ“Š TABLEAU DE SYNTHÃˆSE -->
        <div class="synthese-section">
          <h3>ğŸ“Š RÃ©capitulatif des participations</h3>
          <div class="stats-global">
            <span class="stat-item">
              <strong>{{ tournoi.total_general }}</strong> Ã©quipes ont participÃ©
            </span>
            <span class="stat-item">
              <strong>{{ tournoi.nb_clubs_total }}</strong> clubs participants
            </span>
            <span class="stat-item">
              <strong>{{ tournoi.nb_categories }}</strong> catÃ©gories
            </span>
          </div>

          <table class="tableau-synthese">
            <thead>
              <tr>
                <th>CatÃ©gorie</th>
                <th>Sexe</th>
                <th>Zone</th>
                <th>Clubs</th>
                <th>Ã‰quipes</th>
                <th>DÃ©tails</th>
              </tr>
            </thead>
            <tbody>
              {% for ligne in tournoi.tableau_synthese %}
                <tr>
                  <td data-label="CatÃ©gorie"><strong>{{ ligne.categorie }}</strong></td>
                  <td data-label="Sexe">{{ ligne.sexe }}</td>
                  <td data-label="Zone">{{ ligne.zone }}</td>
                  <td data-label="Clubs" class="text-center">{{ ligne.nb_clubs }}</td>
                  <td data-label="Ã‰quipes" class="text-center">
                    <strong>{{ ligne.total_equipes }}</strong>
                  </td>
                  <td data-label="Actions" class="text-center">
                    <a href="#cat-{{ ligne.cle }}" class="btn-details">ğŸ‘ï¸ Voir dÃ©tails</a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- ğŸ“‹ DÃ‰TAILS PAR CATÃ‰GORIE -->
        <div class="details-section">
          <h3>ğŸ“‹ DÃ©tails par catÃ©gorie</h3>

          {% for categorie in tournoi.categories_detaillees %}
            <div class="categorie-block" id="cat-{{ categorie.cle }}">
              <h4 class="categorie-titre">
                {{ categorie.categorie }} {{ categorie.sexe }}
                {% if categorie.zone != "Toutes zones" %}({{ categorie.zone }}){% endif %}
                <span class="badge">
                  {{ categorie.nb_clubs }} club{{ categorie.nb_clubs|pluralize }} -
                  {{ categorie.total_equipes }} Ã©quipe{{ categorie.total_equipes|pluralize }}
                </span>
              </h4>

              <ul class="declaration-list">
                {% for d in categorie.declarations %}
                  <li class="declaration-item archive-item">
                    <strong>{{ d.club.nom }}</strong> â€”
                    {{ d.nombre_equipes }} Ã©quipe{{ d.nombre_equipes|pluralize }}
                    <br>
                    <small>
                      ğŸ“… DÃ©clarÃ© le {{ d.date_declaration|date:"d/m/Y H:i" }}
                    </small>
                    {% if d.remarques %}
                      <br><small class="remarques">ğŸ’¬ {{ d.remarques }}</small>
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% endfor %}
        </div>

        <hr class="tournoi-separator">
      </div>
    {% endfor %}
  {% else %}
    <div class="no-data">
      <p>ğŸ“­ Aucun tournoi passÃ© pour le moment.</p>
      <p><small>Les tournois terminÃ©s apparaÃ®tront ici automatiquement.</small></p>
    </div>
  {% endif %}

  <!-- ğŸ”— NAVIGATION -->
  <div class="navigation-links">
    <a href="{% url 'consultation' %}" class="btn btn-primary">
      ğŸ”œ Voir les tournois Ã  venir
    </a>
    <a href="{% url 'declaration' %}" class="btn btn-success">
      â• Nouvelle dÃ©claration
    </a>
  </div>
</div>
{% endblock %}