{% extends "staff/base_staff.html" %}

{% block title %}Gestion Candidatures - Staff VolleyChamp{% endblock %}

{% block content %}
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ“‹ HEADER
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="staff-header">
    <h1>ğŸ“‹ Gestion des Candidatures</h1>
    <p>Validation des clubs souhaitant organiser des tournois</p>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ“Š STATISTIQUES
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section class="dashboard-section">
    <div class="stats-grid">
        <div class="stat-card stat-warning">
            <div class="stat-icon">â³</div>
            <div class="stat-content">
                <div class="stat-number">{{ nb_en_attente }}</div>
                <div class="stat-label">En attente</div>
            </div>
        </div>
        
        <div class="stat-card stat-success">
            <div class="stat-icon">âœ…</div>
            <div class="stat-content">
                <div class="stat-number">{{ nb_validees }}</div>
                <div class="stat-label">ValidÃ©es</div>
            </div>
        </div>
        
        <div class="stat-card stat-danger">
            <div class="stat-icon">âŒ</div>
            <div class="stat-content">
                <div class="stat-number">{{ nb_refusees }}</div>
                <div class="stat-label">RefusÃ©es</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">ğŸ“Š</div>
            <div class="stat-content">
                <div class="stat-number">{{ nb_total }}</div>
                <div class="stat-label">Total</div>
            </div>
        </div>
    </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ” FILTRES
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section class="dashboard-section">
    <form method="get" class="filters-section">
        <div class="filters-row">
            <!-- Filtre Statut -->
            <div class="filter-group">
                <label for="statut">Statut</label>
                <select name="statut" id="statut" class="form-control">
                    <option value="tous" {% if statut == 'tous' %}selected{% endif %}>Tous</option>
                    <option value="EN_ATTENTE" {% if statut == 'EN_ATTENTE' %}selected{% endif %}>â³ En attente</option>
                    <option value="VALIDEE" {% if statut == 'VALIDEE' %}selected{% endif %}>âœ… ValidÃ©es</option>
                    <option value="REFUSEE" {% if statut == 'REFUSEE' %}selected{% endif %}>âŒ RefusÃ©es</option>
                    <option value="RETIREE" {% if statut == 'RETIREE' %}selected{% endif %}>ğŸ”™ RetirÃ©es</option>
                </select>
            </div>
            
            <!-- Filtre Tournoi -->
            <div class="filter-group">
                <label for="tournoi">Tournoi</label>
                <select name="tournoi" id="tournoi" class="form-control">
                    <option value="">Tous les tournois</option>
                    {% for t in tournois_liste %}
                        <option value="{{ t.id }}" {% if tournoi_id == t.id|stringformat:"s" %}selected{% endif %}>
                            {{ t.date|date:"d/m/Y" }} - {{ t.get_categorie_age_display }} {{ t.get_sexe_display }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Recherche -->
            <div class="filter-group">
                <label for="q">Recherche</label>
                <input 
                    type="text" 
                    name="q" 
                    id="q" 
                    value="{{ recherche }}" 
                    placeholder="Nom du club, lieu..."
                    class="form-control"
                >
            </div>
            
            <!-- Boutons -->
            <div class="filter-group" style="display: flex; gap: 0.5rem; align-items: flex-end;">
                <button type="submit" class="btn btn-primary">
                    ğŸ” Filtrer
                </button>
                {% if statut != 'tous' or tournoi_id or recherche %}
                    <a href="{% url 'staff:candidatures_liste' %}" class="btn btn-secondary">
                        ğŸ”„ RÃ©initialiser
                    </a>
                {% endif %}
            </div>
        </div>
    </form>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ“‹ LISTE CANDIDATURES
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section class="dashboard-section">
    <h2 class="section-title">
        ğŸ“‹ Candidatures ({{ candidatures.count }})
    </h2>
    
    {% if candidatures %}
        <div class="candidatures-list">
            {% for candidature in candidatures %}
            <div class="tournoi-card">
                <div class="tournoi-header">
                    <div>
                        <h3>{{ candidature.club.nom }}</h3>
                        <div style="margin-top: 0.25rem; font-size: 0.9rem; color: #666;">
                            ğŸ—“ï¸ {{ candidature.tournoi }}
                        </div>
                    </div>
                    <span class="badge badge-{{ candidature.statut|lower }}">
                        {% if candidature.statut == 'EN_ATTENTE' %}â³ En attente
                        {% elif candidature.statut == 'VALIDEE' %}âœ… ValidÃ©e
                        {% elif candidature.statut == 'REFUSEE' %}âŒ RefusÃ©e
                        {% elif candidature.statut == 'RETIREE' %}ğŸ”™ RetirÃ©e
                        {% endif %}
                    </span>
                </div>
                
                <div class="tournoi-body">
                    <!-- Informations candidature -->
                    <div class="tournoi-info">
                        <div><strong>ğŸ“ Lieu proposÃ© :</strong> {{ candidature.lieu }}</div>
                        <div><strong>ğŸ‘¤ Contact :</strong> {{ candidature.declarant }}</div>
                        <div><strong>ğŸ“§ Email :</strong> {{ candidature.email_contact }}</div>
                        {% if candidature.telephone_contact %}
                            <div><strong>ğŸ“ TÃ©l :</strong> {{ candidature.telephone_contact }}</div>
                        {% endif %}
                        {% if candidature.remarques %}
                            <div style="margin-top: 0.5rem;">
                                <strong>ğŸ’¬ Remarques :</strong>
                                <div style="margin-top: 0.25rem; font-style: italic; color: #555;">
                                    {{ candidature.remarques }}
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Dates -->
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e1e8ed; font-size: 0.85rem; color: #666;">
                        <div>ğŸ• DÃ©posÃ©e le {{ candidature.created_at|date:"d/m/Y Ã  H:i" }}</div>
                        {% if candidature.date_traitement %}
                            <div>
                                {% if candidature.statut == 'VALIDEE' %}âœ…{% elif candidature.statut == 'REFUSEE' %}âŒ{% endif %}
                                TraitÃ©e le {{ candidature.date_traitement|date:"d/m/Y Ã  H:i" }}
                                {% if candidature.traite_par %}
                                    par {{ candidature.traite_par.get_full_name|default:candidature.traite_par.username }}
                                {% endif %}
                            </div>
                        {% endif %}
                        {% if candidature.raison_refus %}
                            <div style="margin-top: 0.5rem; padding: 0.5rem; background: #fff3cd; border-left: 3px solid #ffc107; border-radius: 4px;">
                                <strong>Raison du refus :</strong> {{ candidature.raison_refus }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Actions (seulement si EN_ATTENTE) -->
                    {% if candidature.statut == 'EN_ATTENTE' %}
                        <div style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <a href="{% url 'staff:candidature_valider' candidature.id %}" class="btn btn-success btn-sm">
                                âœ… Valider
                            </a>
                            <a href="{% url 'staff:candidature_refuser' candidature.id %}" class="btn btn-danger btn-sm">
                                âŒ Refuser
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-data">
            <p>ğŸ¤·â€â™‚ï¸ Aucune candidature trouvÃ©e avec ces filtres.</p>
            {% if statut != 'tous' or tournoi_id or recherche %}
                <p><small>Essayez de modifier les filtres.</small></p>
            {% endif %}
        </div>
    {% endif %}
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ”— NAVIGATION
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="navigation-links" style="margin-top: 2rem;">
    <a href="{% url 'staff:dashboard' %}" class="btn btn-secondary">
        ğŸ  Retour au dashboard
    </a>
    <a href="{% url 'staff:tournois_liste' %}" class="btn btn-primary">
        ğŸ—“ï¸ Voir les tournois
    </a>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Badge candidatures */
    .badge-en_attente {
        background: linear-gradient(135deg, #ffc107, #ff9800);
        color: white;
    }
    
    .badge-validee {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
    }
    
    .badge-refusee {
        background: linear-gradient(135deg, #dc3545, #c82333);
        color: white;
    }
    
    .badge-retiree {
        background: linear-gradient(135deg, #6c757d, #5a6268);
        color: white;
    }
    
    /* Liste candidatures */
    .candidatures-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .filters-row {
            flex-direction: column;
        }
        
        .filter-group {
            width: 100%;
        }
    }
</style>
{% endblock %}
